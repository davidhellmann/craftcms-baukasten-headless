---
// Imports
import DefaultLayout from '@layouts/Default.astro';
import entryQuery from '@graphql/entry.graphql'
import { useGraphqlQuery } from '@composables/useGraphqlQuery';
import { print } from 'graphql/language/printer';
import { useGetCurrentSiteData, findAllExpectPrimary } from '@composables/useGetCurrentSite';

// Create Static Routes
export async function getStaticPaths() {
    const { data: { entries, translations } } = await useGraphqlQuery({
        query: print(entryQuery),
        routeQuery: {},
        variables: {
            section: ['pages', 'news', 'home'],
            site: findAllExpectPrimary('handle'),
            language: findAllExpectPrimary('language')
        }
    })


    return entries.map((entry: any) => {
        return {
            params: {
                uri: entry.uri === '__home__' ? 'index' : entry.uri,
                site: useGetCurrentSiteData({id: entry.siteId }).urlParameter
            },
            props: { 
                id: entry.id,
                siteId: Number(entry.siteId), 
                sectionHandle: entry.sectionHandle, 
                entryType: entry.typeHandle,
                translations,
                seo: {
                    ...entry.seomatic
                }
             },
        };
    });
}

// Variables
const { id, siteId, sectionHandle, entryType, translations, seo } = Astro.props;
---

<DefaultLayout {id} {siteId} {sectionHandle} {entryType} {translations} {seo} lang="de" />