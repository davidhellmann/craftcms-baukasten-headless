---
export const prerender = false;
import "@/css/app.css";
import GlobalLayout from "@/layouts/Global.astro";
import { getEntryPreviewData } from "@/utils/getEntryPreviewData";

const { searchParams } = Astro.url;
const routeQuery = Object.fromEntries(searchParams);

const {
  id,
  siteId,
  token,
  "x-craft-preview": xCraftPreview,
  "x-craft-live-preview": xCraftLivePreview,
} = routeQuery;

const entry = await getEntryPreviewData(
  parseInt(id),
  parseInt(siteId),
  token,
  xCraftPreview,
  xCraftLivePreview,
);

if (!entry) {
  Astro.response.status = 404;
  Astro.response.statusText = "Not found";
}
---

<GlobalLayout
  uri={entry?.uri}
  lang={entry?.language}
  siteHandle={entry?.siteHandle}
  siteId={entry?.siteId}
  typeHandle={entry?.typeHandle}
  sectionHandle={entry?.sectionHandle}
  entryId={entry?.canonicalId}
  token={token}
  xCraftPreview={xCraftPreview}
  xCraftLivePreview={xCraftLivePreview}
/>
